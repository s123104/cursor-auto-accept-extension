<!doctype html>
<html lang="zh-TW">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Cursor Auto Accept Scripts Test</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
      }
      .test-section {
        border: 1px solid #ccc;
        padding: 20px;
        margin: 20px 0;
      }
      .success {
        color: green;
      }
      .error {
        color: red;
      }
      button {
        padding: 10px 20px;
        margin: 10px;
      }
      .log {
        background: #f5f5f5;
        padding: 10px;
        height: 200px;
        overflow-y: auto;
      }
    </style>
  </head>
  <body>
    <h1>ğŸ¯ Cursor Auto Accept Scripts æ¸¬è©¦é é¢</h1>

    <div class="test-section">
      <h2>ğŸ“Š è…³æœ¬è¼‰å…¥æ¸¬è©¦</h2>
      <div id="load-status">æº–å‚™æ¸¬è©¦...</div>
      <button onclick="loadEnhancedScript()">è¼‰å…¥å¢å¼·ç‰ˆè…³æœ¬</button>
      <button onclick="loadCompleteScript()">è¼‰å…¥å®Œæ•´ç‰ˆè…³æœ¬</button>
      <button onclick="clearConsole()">æ¸…é™¤æ—¥èªŒ</button>
    </div>

    <div class="test-section">
      <h2>ğŸ” æ¨¡æ“¬ç’°å¢ƒæ¸¬è©¦</h2>
      <p>æ¨¡æ“¬ Cursor ä»‹é¢å…ƒç´ ï¼š</p>
      <div class="full-input-box" style="border: 1px solid #ddd; padding: 10px; margin: 10px 0">
        <div>æ¨¡æ“¬è¼¸å…¥æ¡†</div>
      </div>

      <div
        class="composer-code-block-container"
        style="border: 1px solid #ddd; padding: 10px; margin: 10px 0"
      >
        <div class="composer-code-block-filename">
          <span style="direction: ltr">test-file.js</span>
        </div>
        <div class="composer-code-block-status">
          <span>+5 -2</span>
        </div>
        <button onclick="simulateClick('accept')">Accept</button>
        <button onclick="simulateClick('accept all')">Accept All</button>
        <button onclick="simulateClick('run')">Run</button>
      </div>

      <span
        class="markdown-link"
        data-link="command:composer.resumeCurrentChat"
        onclick="simulateClick('resume')"
        style="cursor: pointer; color: blue"
      >
        Resume conversation
      </span>
    </div>

    <div class="test-section">
      <h2>ğŸ“ æ¸¬è©¦æ—¥èªŒ</h2>
      <div id="console-log" class="log"></div>
    </div>

    <script>
      let loadedScripts = [];

      // è¦†å¯« console.log ä»¥é¡¯ç¤ºåœ¨é é¢ä¸Š
      const originalLog = console.log;
      console.log = function (...args) {
        originalLog.apply(console, args);
        const logDiv = document.getElementById('console-log');
        if (logDiv) {
          const entry = document.createElement('div');
          entry.textContent = new Date().toLocaleTimeString() + ': ' + args.join(' ');
          logDiv.appendChild(entry);
          logDiv.scrollTop = logDiv.scrollHeight;
        }
      };

      async function loadScript(url, name) {
        try {
          const response = await fetch(url);
          const scriptContent = await response.text();

          // åœ¨æ–°çš„ script æ¨™ç±¤ä¸­åŸ·è¡Œ
          const script = document.createElement('script');
          script.textContent = scriptContent;
          document.head.appendChild(script);

          loadedScripts.push(name);
          updateStatus(`âœ… ${name} è¼‰å…¥æˆåŠŸ`);
          console.log(`âœ… ${name} è¼‰å…¥æˆåŠŸ`);

          return true;
        } catch (error) {
          updateStatus(`âŒ ${name} è¼‰å…¥å¤±æ•—: ${error.message}`);
          console.log(`âŒ ${name} è¼‰å…¥å¤±æ•—:`, error);
          return false;
        }
      }

      function loadEnhancedScript() {
        loadScript('./autoAccept.enhanced.js', 'å¢å¼·ç‰ˆè…³æœ¬ v2.0');
      }

      function loadCompleteScript() {
        loadScript('./autoAccept.part2.js', 'å®Œæ•´ç‰ˆè…³æœ¬ v2.0');
      }

      function updateStatus(message) {
        const statusDiv = document.getElementById('load-status');
        statusDiv.innerHTML = message;
        statusDiv.className = message.includes('âœ…')
          ? 'success'
          : message.includes('âŒ')
            ? 'error'
            : '';
      }

      function simulateClick(type) {
        console.log(`ğŸ–±ï¸ æ¨¡æ“¬é»æ“Š: ${type}`);

        // æª¢æŸ¥æ˜¯å¦æœ‰è¼‰å…¥çš„è…³æœ¬
        if (window.CursorAutoAccept) {
          console.log('ğŸ“Š å¢å¼·ç‰ˆè…³æœ¬ç‹€æ…‹:', window.CursorAutoAccept.status());
        }

        if (window.CursorAutoAcceptComplete) {
          console.log('ğŸ“Š å®Œæ•´ç‰ˆè…³æœ¬ç‹€æ…‹:', window.CursorAutoAcceptComplete.status());
        }
      }

      function clearConsole() {
        document.getElementById('console-log').innerHTML = '';
      }

      // é é¢è¼‰å…¥æ™‚çš„åˆå§‹åŒ–
      window.addEventListener('load', () => {
        console.log('ğŸš€ æ¸¬è©¦é é¢è¼‰å…¥å®Œæˆ');
        updateStatus('æº–å‚™è¼‰å…¥è…³æœ¬...');
      });
    </script>
  </body>
</html>
