<!doctype html>
<html lang="zh-TW">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CursorAutoAccept Enhanced v2.0.1 - æ”¶æŠ˜åŠŸèƒ½æ¸¬è©¦</title>
    <style>
      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        margin: 20px;
        background-color: #1e1e1e;
        color: #ccc;
      }
      .test-section {
        background: #2d2d2d;
        padding: 20px;
        margin: 20px 0;
        border-radius: 8px;
        border: 1px solid #444;
      }
      .test-button {
        background: #0d7377;
        color: white;
        border: none;
        padding: 8px 16px;
        margin: 5px;
        border-radius: 4px;
        cursor: pointer;
        font-size: 12px;
      }
      .test-button:hover {
        background: #0a5d61;
      }
      .status {
        background: #333;
        padding: 10px;
        border-radius: 4px;
        margin: 10px 0;
        font-family: monospace;
        font-size: 12px;
      }
      .success {
        color: #4caf50;
      }
      .warning {
        color: #ff9800;
      }
      .error {
        color: #f44336;
      }
      .info {
        color: #2196f3;
      }
    </style>
  </head>
  <body>
    <h1>ğŸ§ª CursorAutoAccept Enhanced v2.0.1 æ¸¬è©¦</h1>

    <div class="test-section">
      <h2>ğŸ“‹ åŠŸèƒ½å®Œæ•´æ€§æª¢æŸ¥</h2>
      <div class="status" id="functionality-status">æª¢æŸ¥ä¸­...</div>
      <button class="test-button" onclick="checkFunctionality()">æª¢æŸ¥æ‰€æœ‰åŠŸèƒ½</button>
    </div>

    <div class="test-section">
      <h2>ğŸ”„ æ”¶æŠ˜åŠŸèƒ½æ¸¬è©¦</h2>
      <div class="status" id="collapse-status">ç­‰å¾…æ¸¬è©¦...</div>
      <button class="test-button" onclick="testCollapse()">æ¸¬è©¦æ”¶æŠ˜åŠŸèƒ½</button>
      <button class="test-button" onclick="testTabSwitching()">æ¸¬è©¦æ¨™ç±¤åˆ‡æ›</button>
    </div>

    <div class="test-section">
      <h2>ğŸ® æ‰‹å‹•æ§åˆ¶</h2>
      <button class="test-button" onclick="CursorAutoAccept.start()">å•Ÿå‹• AutoAccept</button>
      <button class="test-button" onclick="CursorAutoAccept.stop()">åœæ­¢ AutoAccept</button>
      <button class="test-button" onclick="showStatus()">é¡¯ç¤ºç‹€æ…‹</button>
      <button class="test-button" onclick="CursorAutoAccept.analytics.show()">é¡¯ç¤ºåˆ†æ</button>
    </div>

    <div class="test-section">
      <h2>ğŸ” é™¤éŒ¯å·¥å…·</h2>
      <button class="test-button" onclick="CursorAutoAccept.debug.enable()">å•Ÿç”¨é™¤éŒ¯</button>
      <button class="test-button" onclick="CursorAutoAccept.debug.search()">æœå°‹æŒ‰éˆ•</button>
      <button class="test-button" onclick="testConfigChange()">æ¸¬è©¦é…ç½®è®Šæ›´</button>
    </div>

    <div class="test-section">
      <h2>ğŸ“Š æ¸¬è©¦çµæœ</h2>
      <div class="status" id="test-results">ç­‰å¾…æ¸¬è©¦åŸ·è¡Œ...</div>
    </div>

    <!-- è¼‰å…¥å¢å¼·ç‰ˆè…³æœ¬ -->
    <script src="autoAccept.enhanced.js"></script>

    <script>
      let testResults = [];

      function log(message, type = 'info') {
        const timestamp = new Date().toLocaleTimeString();
        const resultDiv = document.getElementById('test-results');
        resultDiv.innerHTML += `<div class="${type}">[${timestamp}] ${message}</div>`;
        console.log(`[Test] ${message}`);
      }

      function checkFunctionality() {
        const statusDiv = document.getElementById('functionality-status');
        statusDiv.innerHTML = '';

        const checks = [
          {
            name: 'CursorAutoAccept å‘½åç©ºé–“',
            test: () => typeof window.CursorAutoAccept === 'object',
          },
          { name: 'start() æ–¹æ³•', test: () => typeof CursorAutoAccept.start === 'function' },
          { name: 'stop() æ–¹æ³•', test: () => typeof CursorAutoAccept.stop === 'function' },
          { name: 'status() æ–¹æ³•', test: () => typeof CursorAutoAccept.status === 'function' },
          {
            name: 'configure() æ–¹æ³•',
            test: () => typeof CursorAutoAccept.configure === 'function',
          },
          { name: 'analytics ç‰©ä»¶', test: () => typeof CursorAutoAccept.analytics === 'object' },
          { name: 'debug ç‰©ä»¶', test: () => typeof CursorAutoAccept.debug === 'object' },
          {
            name: 'æ§åˆ¶é¢æ¿å…ƒç´ ',
            test: () => document.getElementById('cursor-auto-accept-v2-panel') !== null,
          },
          { name: 'å‘å¾Œç›¸å®¹ API', test: () => typeof window.startAccept === 'function' },
        ];

        let passed = 0;
        checks.forEach(check => {
          try {
            const result = check.test();
            const status = result ? 'âœ…' : 'âŒ';
            const className = result ? 'success' : 'error';
            statusDiv.innerHTML += `<div class="${className}">${status} ${check.name}</div>`;
            if (result) passed++;
          } catch (error) {
            statusDiv.innerHTML += `<div class="error">âŒ ${check.name} - éŒ¯èª¤: ${error.message}</div>`;
          }
        });

        const percentage = Math.round((passed / checks.length) * 100);
        statusDiv.innerHTML += `<div class="info"><strong>åŠŸèƒ½å®Œæ•´æ€§: ${percentage}% (${passed}/${checks.length})</strong></div>`;
        log(`åŠŸèƒ½æª¢æŸ¥å®Œæˆ: ${percentage}% é€šé`, percentage === 100 ? 'success' : 'warning');
      }

      function testCollapse() {
        const statusDiv = document.getElementById('collapse-status');
        const panel = document.getElementById('cursor-auto-accept-v2-panel');

        if (!panel) {
          statusDiv.innerHTML = '<div class="error">âŒ æ§åˆ¶é¢æ¿æœªæ‰¾åˆ°</div>';
          log('æ”¶æŠ˜æ¸¬è©¦å¤±æ•—: æ§åˆ¶é¢æ¿æœªæ‰¾åˆ°', 'error');
          return;
        }

        statusDiv.innerHTML = '';
        let step = 1;

        // æ¸¬è©¦æ­¥é©Ÿ 1: æª¢æŸ¥åˆå§‹ç‹€æ…‹
        const isInitiallyMinimized = panel.classList.contains('aa-minimized');
        statusDiv.innerHTML += `<div class="info">æ­¥é©Ÿ ${step++}: åˆå§‹ç‹€æ…‹ - ${isInitiallyMinimized ? 'å·²æ”¶æŠ˜' : 'å·²å±•é–‹'}</div>`;

        // æ¸¬è©¦æ­¥é©Ÿ 2: æ”¶æŠ˜é¢æ¿
        setTimeout(() => {
          CursorAutoAccept.instance.toggleMinimize();
          const isMinimized = panel.classList.contains('aa-minimized');
          statusDiv.innerHTML += `<div class="${isMinimized ? 'success' : 'error'}">æ­¥é©Ÿ ${step++}: æ”¶æŠ˜æ“ä½œ - ${isMinimized ? 'âœ… æˆåŠŸ' : 'âŒ å¤±æ•—'}</div>`;

          // æ¸¬è©¦æ­¥é©Ÿ 3: å±•é–‹é¢æ¿
          setTimeout(() => {
            CursorAutoAccept.instance.toggleMinimize();
            const isExpanded = !panel.classList.contains('aa-minimized');
            statusDiv.innerHTML += `<div class="${isExpanded ? 'success' : 'error'}">æ­¥é©Ÿ ${step++}: å±•é–‹æ“ä½œ - ${isExpanded ? 'âœ… æˆåŠŸ' : 'âŒ å¤±æ•—'}</div>`;

            log('æ”¶æŠ˜åŠŸèƒ½æ¸¬è©¦å®Œæˆ', 'success');
          }, 500);
        }, 500);
      }

      function testTabSwitching() {
        const statusDiv = document.getElementById('collapse-status');

        // æ¸¬è©¦æ¨™ç±¤åˆ‡æ›æ˜¯å¦å½±éŸ¿æ”¶æŠ˜åŠŸèƒ½
        statusDiv.innerHTML += '<div class="info">æ¸¬è©¦æ¨™ç±¤åˆ‡æ›èˆ‡æ”¶æŠ˜åŠŸèƒ½å…¼å®¹æ€§...</div>';

        // åˆ‡æ›åˆ°åˆ†ææ¨™ç±¤
        CursorAutoAccept.instance.switchTab('analytics');
        setTimeout(() => {
          // æ”¶æŠ˜é¢æ¿
          CursorAutoAccept.instance.toggleMinimize();
          const panel = document.getElementById('cursor-auto-accept-v2-panel');
          const isMinimized = panel.classList.contains('aa-minimized');

          statusDiv.innerHTML += `<div class="${isMinimized ? 'success' : 'error'}">åˆ†ææ¨™ç±¤æ”¶æŠ˜æ¸¬è©¦ - ${isMinimized ? 'âœ… æˆåŠŸ' : 'âŒ å¤±æ•—'}</div>`;

          // åˆ‡æ›å›ä¸»æ¨™ç±¤
          setTimeout(() => {
            CursorAutoAccept.instance.switchTab('main');
            CursorAutoAccept.instance.toggleMinimize(); // å±•é–‹

            statusDiv.innerHTML += '<div class="success">âœ… æ¨™ç±¤åˆ‡æ›æ¸¬è©¦å®Œæˆ</div>';
            log('æ¨™ç±¤åˆ‡æ›å…¼å®¹æ€§æ¸¬è©¦å®Œæˆ', 'success');
          }, 500);
        }, 500);
      }

      function showStatus() {
        const status = CursorAutoAccept.status();
        log(`ç‹€æ…‹: ${JSON.stringify(status, null, 2)}`, 'info');
      }

      function testConfigChange() {
        const originalConfig = CursorAutoAccept.status().config;
        log(`åŸå§‹é…ç½®: ${JSON.stringify(originalConfig)}`, 'info');

        // æ¸¬è©¦é…ç½®è®Šæ›´
        CursorAutoAccept.configure({ enableAcceptAll: false });
        const newConfig = CursorAutoAccept.status().config;

        const success = newConfig.enableAcceptAll === false;
        log(`é…ç½®è®Šæ›´æ¸¬è©¦: ${success ? 'âœ… æˆåŠŸ' : 'âŒ å¤±æ•—'}`, success ? 'success' : 'error');

        // æ¢å¾©åŸå§‹é…ç½®
        CursorAutoAccept.configure(originalConfig);
      }

      // é é¢è¼‰å…¥å®Œæˆå¾Œè‡ªå‹•åŸ·è¡ŒåŸºæœ¬æª¢æŸ¥
      window.addEventListener('load', () => {
        setTimeout(() => {
          log('ğŸš€ CursorAutoAccept Enhanced v2.0.1 æ¸¬è©¦é é¢å·²è¼‰å…¥', 'success');
          checkFunctionality();
        }, 1000);
      });
    </script>
  </body>
</html>
