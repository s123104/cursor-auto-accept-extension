<!doctype html>
<html lang="zh-TW">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>åˆ†æåŠŸèƒ½æ¸¬è©¦ - Cursor Auto Accept Enhanced</title>
    <style>
      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        background: #1e1e1e;
        color: #ccc;
        padding: 20px;
        margin: 0;
      }
      .test-container {
        max-width: 800px;
        margin: 0 auto;
        background: #2d2d2d;
        padding: 20px;
        border-radius: 8px;
      }
      .test-section {
        margin-bottom: 20px;
        padding: 15px;
        background: #252525;
        border-radius: 6px;
      }
      .test-section h3 {
        margin-top: 0;
        color: #fff;
      }
      button {
        background: #4caf50;
        color: white;
        border: none;
        padding: 8px 16px;
        border-radius: 4px;
        cursor: pointer;
        margin: 4px;
        font-size: 12px;
      }
      button:hover {
        background: #45a049;
      }
      .simulate-btn {
        background: #2196f3;
      }
      .simulate-btn:hover {
        background: #1976d2;
      }
      .clear-btn {
        background: #f44336;
      }
      .clear-btn:hover {
        background: #da190b;
      }
      .status {
        background: #333;
        padding: 10px;
        border-radius: 4px;
        font-family: monospace;
        font-size: 11px;
      }
      .fake-cursor-elements {
        display: none;
      }
    </style>
  </head>
  <body>
    <div class="test-container">
      <h1>ğŸ§ª Cursor Auto Accept Enhanced åˆ†æåŠŸèƒ½æ¸¬è©¦</h1>

      <div class="test-section">
        <h3>ğŸ“Š åŸºæœ¬æ§åˆ¶</h3>
        <button onclick="loadScript()">è¼‰å…¥è…³æœ¬</button>
        <button onclick="CursorAutoAccept.analytics.show()">é¡¯ç¤ºåˆ†æé é¢</button>
        <button onclick="showStatus()">é¡¯ç¤ºç‹€æ…‹</button>
      </div>

      <div class="test-section">
        <h3>ğŸ¯ æ¨¡æ“¬æ“ä½œ</h3>
        <button class="simulate-btn" onclick="simulateFileAcceptance('test.js', 'accept', 10, 2)">
          æ¨¡æ“¬æ¥å— test.js
        </button>
        <button
          class="simulate-btn"
          onclick="simulateFileAcceptance('README.md', 'acceptAll', 25, 0)"
        >
          æ¨¡æ“¬å…¨éƒ¨æ¥å— README.md
        </button>
        <button class="simulate-btn" onclick="simulateFileAcceptance('api.py', 'run', 15, 5)">
          æ¨¡æ“¬åŸ·è¡Œ api.py
        </button>
        <button class="simulate-btn" onclick="simulateMultipleOperations()">æ¨¡æ“¬å¤šå€‹æ“ä½œ</button>
      </div>

      <div class="test-section">
        <h3>ğŸ“ æª”æ¡ˆæ¸¬è©¦</h3>
        <button class="simulate-btn" onclick="addTestFiles()">æ·»åŠ æ¸¬è©¦æª”æ¡ˆ</button>
        <button onclick="CursorAutoAccept.analytics.export()">åŒ¯å‡ºåˆ†æè³‡æ–™</button>
        <button class="clear-btn" onclick="CursorAutoAccept.analytics.clear()">æ¸…é™¤åˆ†æè³‡æ–™</button>
      </div>

      <div class="test-section">
        <h3>ğŸ“ˆ ç‹€æ…‹é¡¯ç¤º</h3>
        <div id="status" class="status">ç­‰å¾…è¼‰å…¥è…³æœ¬...</div>
      </div>
    </div>

    <!-- æ¨¡æ“¬ Cursor çš„ DOM çµæ§‹ -->
    <div class="fake-cursor-elements">
      <div class="full-input-box"></div>
      <div class="composer-code-block-container">
        <div class="composer-code-block-filename">
          <span style="direction: ltr">test.js</span>
        </div>
        <div class="composer-code-block-status">
          <span style="color: green">+10</span>
          <span style="color: red">-2</span>
        </div>
      </div>
    </div>

    <script>
      let scriptLoaded = false;

      function loadScript() {
        if (scriptLoaded) {
          updateStatus('è…³æœ¬å·²è¼‰å…¥');
          return;
        }

        const script = document.createElement('script');
        script.src = './autoAccept.enhanced.js';
        script.onload = () => {
          scriptLoaded = true;
          updateStatus('âœ… Enhanced v2.0.1 è…³æœ¬å·²è¼‰å…¥');

          // ç­‰å¾…è…³æœ¬åˆå§‹åŒ–
          setTimeout(() => {
            if (window.CursorAutoAccept) {
              updateStatus('âœ… CursorAutoAccept å·²å°±ç·’ï¼Œé»æ“Š"é¡¯ç¤ºåˆ†æé é¢"æŸ¥çœ‹åŠŸèƒ½');
            }
          }, 500);
        };
        script.onerror = () => {
          updateStatus('âŒ è…³æœ¬è¼‰å…¥å¤±æ•—');
        };
        document.head.appendChild(script);
      }

      function simulateFileAcceptance(filename, buttonType, addedLines, deletedLines) {
        if (!window.CursorAutoAccept?.instance) {
          updateStatus('âŒ è«‹å…ˆè¼‰å…¥è…³æœ¬');
          return;
        }

        // æ¨¡æ“¬æª”æ¡ˆæ¥å—
        const fileInfo = {
          filename: filename,
          addedLines: addedLines,
          deletedLines: deletedLines,
          timestamp: new Date(),
        };

        const timeSaved = CursorAutoAccept.instance.roiTimer.calculateTimeSaved(buttonType);
        CursorAutoAccept.instance.analytics.recordFileAcceptance(fileInfo, buttonType, timeSaved);
        CursorAutoAccept.instance.totalClicks++;

        updateStatus(`âœ… æ¨¡æ“¬ ${buttonType} æ“ä½œï¼š${filename} (+${addedLines}/-${deletedLines})`);

        // æ›´æ–°UI
        if (
          CursorAutoAccept.instance.currentTab === 'analytics' ||
          CursorAutoAccept.instance.currentTab === 'roi'
        ) {
          CursorAutoAccept.instance.updateAnalyticsContent();
        }
        CursorAutoAccept.instance.updateMainFooter();
      }

      function simulateMultipleOperations() {
        const operations = [
          { file: 'index.html', type: 'accept', add: 5, del: 1 },
          { file: 'style.css', type: 'acceptAll', add: 20, del: 3 },
          { file: 'script.js', type: 'run', add: 15, del: 2 },
          { file: 'package.json', type: 'apply', add: 3, del: 0 },
          { file: 'README.md', type: 'resume', add: 10, del: 0 },
        ];

        operations.forEach((op, index) => {
          setTimeout(() => {
            simulateFileAcceptance(op.file, op.type, op.add, op.del);
          }, index * 200);
        });

        updateStatus('ğŸ”„ åŸ·è¡Œå¤šå€‹æ¨¡æ“¬æ“ä½œ...');
      }

      function addTestFiles() {
        const testFiles = [
          { file: 'components/Header.jsx', type: 'accept', add: 25, del: 5 },
          { file: 'utils/helpers.js', type: 'run', add: 30, del: 10 },
          { file: 'styles/main.scss', type: 'acceptAll', add: 40, del: 15 },
          { file: 'config/database.js', type: 'apply', add: 8, del: 2 },
        ];

        testFiles.forEach((test, index) => {
          setTimeout(() => {
            simulateFileAcceptance(test.file, test.type, test.add, test.del);
          }, index * 100);
        });

        updateStatus('ğŸ“ æ·»åŠ æ¸¬è©¦æª”æ¡ˆè³‡æ–™...');
      }

      function showStatus() {
        if (!window.CursorAutoAccept?.instance) {
          updateStatus('âŒ è«‹å…ˆè¼‰å…¥è…³æœ¬');
          return;
        }

        const status = CursorAutoAccept.status();
        const data = CursorAutoAccept.instance.analytics.exportData();

        const statusText = `
ğŸ“Š ç‹€æ…‹å ±å‘Šï¼š
- åŸ·è¡Œç‹€æ…‹: ${status.isRunning ? 'åŸ·è¡Œä¸­' : 'å·²åœæ­¢'}
- ç¸½é»æ“Šæ•¸: ${status.totalClicks}
- ç¸½æ¥å—æ•¸: ${data.totalAccepts}
- å·²ä¿®æ”¹æª”æ¡ˆ: ${Object.keys(data.files).length}
- ç¸½ç¯€çœæ™‚é–“: ${CursorAutoAccept.instance.formatTimeDuration(data.roiData.totalTimeSaved)}
- æœƒè©±é–‹å§‹: ${new Date(data.sessionStart).toLocaleString()}
            `.trim();

        updateStatus(statusText);
      }

      function updateStatus(message) {
        const statusEl = document.getElementById('status');
        statusEl.textContent = message;
      }

      // è‡ªå‹•è¼‰å…¥è…³æœ¬
      window.addEventListener('load', () => {
        updateStatus('ğŸš€ æ¸¬è©¦é é¢å·²è¼‰å…¥ï¼Œé»æ“Š"è¼‰å…¥è…³æœ¬"é–‹å§‹æ¸¬è©¦');
      });
    </script>
  </body>
</html>
